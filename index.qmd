---
title: Using diagnostic <br/> classification models
subtitle: to Improve Instructional Decision-Making
author: W. Jake Thompson, Ph.D.
format:
  measr-slides-revealjs:
    progress: false
knitr:
  opts_chunk: 
    comment: "#>"
    fig.width: 7
    fig.asp: 0.618
    fig.align: "center"
freeze: true
code-link: true
preload-iframes: true
code-annotations: select
filters:
  - lua/output-line-highlight.lua
---

## Who am I?

```{r setup}
library(tidyverse)
library(ggmeasr)
library(knitr)
library(measr)
library(here)
library(ggdist)
library(magick)
library(gt)
library(gtExtras)

set_theme(plot_margin = margin(5, 0, 0, 0))
```

:::{.columns}
:::{.column width="50%"}
W. Jake Thompson, Ph.D.

* Assistant Director of Psychometrics
  * [ATLAS](https://atlas.ku.edu) | University of Kansas

* Research: Applications of diagnostic psychometric models
  * Lead psychometrician and Co-PI for the [Dynamic Learnings Maps](https://dynamiclearningmaps.org) assessments
  * PI for an [IES-funded](https://ies.ed.gov/funding/grantsearch/details.asp?ID=4546) project to develop software for diagnostic models
:::

:::{.column width="50%"}
:::{.center}

```{r}
#| label: profile-picture
#| out-width: 50%
#| fig-alt: |
#|   Profile picture for Jake Thompson.

include_graphics("figure/wjt-2022-hex.png")
```

:::{.small}
{{< iconify fa6-brands github >}} &nbsp; [@wjakethompson](https://www.gitub.com/wjakethompson)  
{{< iconify fa6-solid globe >}} &nbsp; [wjakethompson.com](https://wjakethompson.com)
:::
:::
:::
:::

## Acknowledgements

The research reported here was supported by the Institute of Education Sciences, U.S. Department of Education, through Grants [R305D210045](https://ies.ed.gov/funding/grantsearch/details.asp?ID=4546) and [R305D240032](https://ies.ed.gov/funding/grantsearch/details.asp?ID=6075) to the University of Kansas Center for Research, Inc., ATLAS. The opinions expressed are those of the authors and do not represent the views of the the Institute or the U.S. Department of Education. <br><br>

:::{.columns}
:::{.column width="15%"}
:::

:::{.column width="70%"}

```{r}
#| label: ies-logo
#| out-width: 100%
#| fig-align: center
#| fig-alt: |
#|   Logo for the Institute of Education Sciences.

include_graphics("figure/IES_InstituteOfEducationSciences_RGB.png")
```

:::

:::{.column width="15%"}
:::
:::

# What are diagnostic models?

## {.empty background-color="#FFFFFF" data-menu-title="Our Example"}

```{r}
#| label: all-taylor
#| out-width: 100%
#| fit-alt: |
#|   Artistic renderings of Taylor Swift from all 15 album releases.

include_graphics(here("figure", "taylor", "all-taylor.png"))
```

## {data-menu-title="Classic psychometrics"}

:::{.columns}
:::{.column width="20%"}
* Traditional assessments and psychometric models measure an overall skill or ability
* Assume a continuous latent trait
:::

:::{.column width="80%"}
```{r}
#| label: taylor-continuum
#| out-width: 100%
#| out-height: 90%
#| fig-alt: |
#|   A normal distribution with images of Taylor Swift from each era overlayed.

taylors <- read_rds(here("data", "taylor-results.rds")) |>
  mutate(x = theta, y = 0.02, img = here("figure", "taylor", "eras", img))

base <- prior(normal(0, 1), type = "intercept") |>
  dcmstan::prior_tibble() |>
  parse_dist(prior) |>
  ggplot(aes(xdist = .dist_obj)) +
  stat_slab(color = palette_measr[1], fill = palette_measr[3])

width <- 0.6
for (i in 1:nrow(taylors)) {
  img <- as.raster(image_read(taylors$img[i]))

  base <- base +
    annotation_raster(
      img,
      taylors$x[i] - (width / 2),
      taylors$x[i] + (width / 2),
      taylors$y[i],
      taylors$y[i] + 0.25
    )
}

base +
  labs(x = "Musical Knowledge", y = NULL) +
  theme(axis.text.y = element_blank(), axis.title.y = element_blank())
```
:::
:::

## Traditional measurement

* The output is a weak ordering of eras due to error in estimates
  * Confident *Taylor Swift* (debut) is the worst
  * Not confident on ordering toward the middle of the distribution

* Limited in the types of questions that can be answered. 
  * Why is *Taylor Swift* (debut) so low?
  * What aspects do each era demonstrate proficiency or competency of?
  * How much skill is "enough" to be competent?
  
## Diagnostic measurement

* Designed to be multidimensional
* No continuum of student achievement
* Categorical constructs
  * Usually binary (e.g., master/nonmaster, proficient/not proficient)

* Several different names in the literature
  * Diagnostic classification models (DCMs)
  * Cognitive diagnostic models (CDMs)
  * Skills assessment models
  * Latent response models
  * Restricted latent class models

## Diagnostic music assessment

:::{.columns}

:::{.column width="30%"}
* Rather than measuring overall musical knowledge, we can break music down into set of skills or *attributes*
  * Songwriting
  * Production
  * Vocals
:::

:::{.column width="70%"}
```{r}
#| label: music-attributes
#| fig-asp: 0.3
#| out-width: 80%
#| out-height: 40%
#| fig-alt: |
#|   Three circles representing the 3 attributes. The bottom half of each circle
#|   is shaded dark, and the top half is light, to indicate there are two
#|   categories for each attribute.

library(ggforce)

tibble(
  start = rep(c(-pi / 2, pi / 2), 3),
  type = rep(c("Proficient", "Non-proficient"), 3),
  skill = rep(c("Songwriting", "Production", "Vocals"), each = 2),
  x = rep(c(3, 6, 9), each = 2),
  y = 0
) |>
  ggplot() +
  geom_arc_bar(
    aes(
      x0 = x,
      y0 = y,
      r0 = 0,
      r = 1.2,
      start = start,
      end = start + pi,
      fill = type
    ),
    color = "white",
    show.legend = FALSE,
    radius = 0
  ) +
  geom_text(
    data = ~ slice(., c(1, 3, 5, 7)),
    aes(x = x, y = 0.2, label = skill),
    size = 5
  ) +
  scale_fill_manual(
    values = c(
      "Proficient" = palette_measr[3],
      "Non-proficient" = palette_measr[1]
    )
  ) +
  coord_equal() +
  theme_void()
```

:::
:::

* Attributes are categorical, often dichotomous (e.g., proficient vs. non-proficient)

## Diagnostic classification models

* DCMs place individuals into groups according to proficiency of multiple attributes

```{r taylor-profiles}
library(gt)
library(gtExtras)

taylor_profiles <- taylors |>
  mutate(across(c(songwriting, production, vocals), \(x) {
    case_when(x == 1 ~ "check", x == 0 ~ "xmark")
  })) |>
  mutate(
    s_color = case_when(
      songwriting == "xmark" ~ palette_measr[2],
      songwriting == "check" ~ palette_measr[4]
    ),
    p_color = case_when(
      production == "xmark" ~ palette_measr[2],
      production == "check" ~ palette_measr[4]
    ),
    v_color = case_when(
      vocals == "xmark" ~ palette_measr[2],
      vocals == "check" ~ palette_measr[4]
    )
  ) |>
  select(
    era,
    album_release,
    img,
    songwriting,
    production,
    vocals,
    ends_with("_color")
  )

taylor_profiles |>
  filter(era %in% c("1989", "reputation", "folklore")) |>
  select(img, songwriting, production, vocals, ends_with("_color")) |>
  gt() |>
  cols_hide(ends_with("_color")) |>
  cols_label(img = "") |>
  # cols_width(img ~ px(100),
  #            everything() ~ px(150)) |>
  gt_img_rows(columns = img, img_source = "local", height = 75) |>
  fmt_icon(songwriting, fill_color = from_column("s_color"), height = "40px") |>
  fmt_icon(production, fill_color = from_column("p_color"), height = "40px") |>
  fmt_icon(vocals, fill_color = from_column("v_color"), height = "40px") |>
  cols_align("center", -img) |>
  gt_theme_measr() |>
  tab_options(table.font.size = 24)
```

## Benefits of DCMs

* Fine-grained, multidimensional results. Answer more questions:
  * Why is *Taylor Swift* (debut) so low?
    * Subpar songwriting, production, and vocals
  * What aspects are albums competent/proficient in?
    * DCMs provide classifications directly

* High reliability with fewer items
  * Less information need to classify than to place precisely along a scale

# Using DCMs to improve student<br/>outcomes

## Applications in educational assessment

:::{.columns}

:::{.column width="60%"}
* [Dynamic Learning Maps](https://dynamiclearningmaps.org)

* [Pathways to Instructionally Embedded assessmet](https://pie.atlas4learning.org)
:::

:::{.column .center width="40%"}

```{r}
include_graphics("figure/qr-emip.png")
```

Thompson & Clark (2024)
:::

:::

# {.empty data-menu-title="measr" background-color="#023047" background-iframe="grid-worms/index.html"}

```{r}
#| label: big-image
#| out-width: 100%
#| fig-alt: "Hex logo for the measr R package."

include_graphics("figure/measr-hex.png")
```

## Improved software for diagnostic models {.flip-brand}

* measr: [R](https://r-project.org) package for Bayesian psychometric measurement using [*Stan*](https://mc-stan.org)

* Easily specify and estimate a DCM
  * Wide variety of DCMs (e.g., LCDM, DINA, C-RUM)
  * Defined attribute relationships and dependencies
  * Supports maximum likelihood and full MCMC model estimation

* Powerful model evaluation tools
  * Model fit using posterior predictive model checks
  * Model comparisons with leave-one-out cross validation
  * Classification accuracy and consistency metrics

More information: <https://measr.r-dcm.org>

# Thank you! {.thank-you data-menu-title="Get in touch" background-color="#023047"}

:::{.columns .v-center-container}

:::{.column .image width="65%"}

```{r}
#| label: big-image
#| out-width: 50%
```

:::

:::{.column width="35%"}

:::{.thank-you-subtitle}

:::{.small}

{{< iconify fa6-solid globe >}} \ [wjakethompson.com](https://wjakethompson.com)  
{{< iconify fa6-solid envelope >}} \ [wjakethompson@ku.edu](mailto:wjakethompson@ku.edu)  
{{< iconify fa6-brands orcid >}} \ [0000-0001-7339-0300](https://orcid.org/0000-0001-7339-0300)  
{{< iconify fa6-brands linkedin >}} \ [in/wjakethompson](https://linkedin.com/in/wjakethompson)  
{{< iconify fa6-brands github >}} \ [@wjakethompson](https://github.com/wjakethompson)  
{{< iconify fa6-brands mastodon >}} \ [@wjakethompson@fosstodon.org](https://fosstodon.org/@wjakethompson)  
{{< iconify fa6-brands bluesky >}} \ [@wjakethompson.com](https://bsky.app/profile/wjakethompson.com)  
{{< iconify fa6-brands threads >}} \ [@wjakethompson](https://www.threads.net/@wjakethompson)  
{{< iconify fa6-brands x-twitter >}} \ [@wjakethompson](https://twitter.com/wjakethompson)  

:::

:::

:::

:::
